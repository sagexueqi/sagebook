# 分布式锁

## 锁和分布式锁

计算机通过锁机制，来解决在并发场景下共享资源互斥的问题。以保证在同一时间，只有同一个进程or线程控制资源。

在单机场景下，竞争的资源来自于节点内部（进程与进程间、线程与线程间），这种基于本地的资源即可实现对操作资源的锁机制：例如磁盘、内存。

但是在分布式场景下，如何界定“唯一的那个”就非常模糊，基于进程间的通信机制时不可保证的；所以，要通过一个中心化的、被大家认可的资源协调者，来界定“唯一的那个”，这个时分布式锁。

## 应用场景

首先，分布式锁和高性能时两个冲突的概念，既然加锁就一定是牺牲了资源修改的并发能力，降低并发能力，就一定会对系统性能有影响；我们的目标是，在对系统性能影响最小的情况下，保证锁的可用以及保证数据的安全。

- 定时任务设计：如果任务同时只能有一个节点触发执行，当到达任务触发时间后，节点竞争分布式锁，以获取到执行机会；
- 处理缓存击穿：当热点Key失效后，只需要有一个节点拿到锁以后进行缓存刷新即可；
- 分布式强一致性场景：库存扣减、文件编辑、订单支付等

### 需要解决的问题

- 可重入性：需要参考JUC中ReentrantLock的实现，基于AQS中state计数器实现重入
- 高可用性：
- 避免死锁
- 锁失效时的数据安全

----

## 实现方案

### 基于Redis原生指令

### 基于Redisson组件实现

### 基于Zookeeper

----
## 思考

### 基于WatchDog续租的机制是否一定可靠？