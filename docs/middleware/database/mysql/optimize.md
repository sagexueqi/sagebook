# Optimize - SQL优化

## SQL优化思路

### 如何发现问题

- DBA提供slow sql log，类似格式如下：
- DBA提供长事务信息告警

```
+------------+-----------+---------------------+---------------------+---------------------+----------------+------------------+---------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| trx_id     | trx_state | trx_started         | now_time            | transaction_seconds | PROCESSLIST_ID | PROCESSLIST_HOST | PROCESSLIST_COMMAND | sql_text                                                                                                                                                                                                                                                                                                                                                                |
+------------+-----------+---------------------+---------------------+---------------------+----------------+------------------+---------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 1331733330 | RUNNING   | 2022-04-26 20:35:00 | 2022-04-26 20:36:08 |                  68 |       12565187 | 172.24.198.89    | Sleep               | SELECT  f_id AS id,f_project_code AS projectCode,f_project_name AS projectName,f_project_logo AS projectLogo,f_project_url AS projectUrl,f_enable AS enable FROM t_table |
+------------+-----------+---------------------+---------------------+---------------------+----------------+------------------+---------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.05 sec)
```

### SQL优化法则

----

## Explain执行计划说明

```sql
 EXPLAIN SELECT ....
```
| id | select_type | table | partitions | type | possible_key | key | key_len | ref | rows | filtered | scalability | Extra | 
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 1 | SIMPLE | t_table | NULL | ALL | NULL | NULL | NULL | NULL | 627352 | 10.00% | O(n) | Using where |

### Explain返回值

#### id

MySQL选定的执行计划中查询的序列号。如果语句里没有子查询等情况，那么整个输出里就只有一个SELECT，这样一来每一行在这个列上都会显示一个1。如果语句中使用了子查询、集合操作、临时表等情况，会给ID列带来很大的复杂性。_这也从一个方面说明，在开发过程中SQL要尽量简单，尽可能减少连接、子查询等操作_

### select_type

语句所使用的查询类型。常用有以下几种标记类型：

- `SIMPLE`: 简单的SELECT，不使用UNION或子查询
- `PRIMARY`: 子查询中最外层的查询